#!/bin/sh

blink1 1 danger

if [ $# -gt 1 ]; then
  echo "${green}Use this after a new ticket has been done in branch dev${reset}"
  echo "USAGE: gc [jira ticket id]"
  echo "EXAMLE: gc PLANO-1234"
  tput setaf 1
  echo "Need a ticket id!"
  tput sgr0
elif [ $# -lt 1 ]; then
  echo "${green}Use this after a new ticket has been done in branch dev${reset}"
  echo "USAGE: gc [jira ticket id]"
  echo "EXAMLE: gc PLANO-1234"
  tput setaf 1
  echo "Need a ticket id!"
  tput sgr0
else

  if [ -f ./../../p4config.txt ]; then
    echo -e '\n☰☰☰☰☰ git commit my changes ☰☰☰☰☰☰'
    git flow feature start $1
    git flow feature checkout $1
    git add -A
    blink1Arm
    echo "${green}git commit -m \"$1\" -m 'Made by Nils'${reset}"
    git commit -m $1 -m 'Made by Nils'
    blink1Disarm
    blink1Arm
    git flow feature finish $1
    blink1Disarm
    gp

    get

    echo -e '\n☰☰☰☰☰☰ p4 submit my changes ☰☰☰☰☰☰'
    BRANCH=$(git branch | sed -n -e 's/^\* \(.*\)/\1/p')
    echo "${green}current branch: $BRANCH${reset}"
    echo "${green}git checkout dev${reset}"
    git checkout dev
    echo "${green}p4 submit -d \"$1\"${reset}"
    p4 submit -d "$1"
    echo "${green}git checkout $BRANCH${reset}"
    git checkout $BRANCH
  else
    ga
    g c $1
    gp
  fi;
fi;
blink1 1 success;
sleep 5;
blink1 off;
