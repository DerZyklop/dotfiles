#!/bin/sh

function processGrunt() {
  if [ -d node_modules ]; then
    echo "${green}Starting grunt${reset}"
    grunt
  else
    echo "${green}Node packages are missing.${reset}"
    echo "${green}Starting npm install${reset}"
    npm install
    echo "${green}Starting grunt${reset}"
    grunt
  fi
}

# Start server (and maybe grunt)
if [ -f boilerplate.json ]; then
  processGrunt
elif [ -f conf/boilerplate.json ]; then
  grunt dev
elif [ -f conf/gruntfile.coffee ]; then
  grunt server
elif [ -f WWW/gruntfile.coffee ]; then
  cd WWW
  processGrunt
elif [ -f gruntfile.coffee ]; then
  processGrunt
elif [ -h gruntfile.coffee ]; then
  processGrunt
elif [ -f gruntfile.js ]; then
  processGrunt
elif [ -h gruntfile.js ]; then
  processGrunt
elif [ -f pw_runserver.sh ]; then
  sh pw_runserver.sh
elif [ -f runserver.sh ]; then
  sh runserver.sh
else
  tput setaf 1
  echo "--------------------------------------"
  echo "       Error: Can't find Grunt.       "
  echo "      I will start localhost by:      "
  echo "        php -S localhost:1337         "
  echo "--------------------------------------"
  tput sgr0
  open http://localhost:1337
  if [ -d 'WWW' ]; then
    php -S localhost:1337 -t ./WWW
  elif [ -d 'www' ]; then
    php -S localhost:1337 -t ./www
  else
    php -S localhost:1337
  fi
fi
